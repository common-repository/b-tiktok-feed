{"version":3,"file":"license.js","mappings":"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","sources":["webpack://b-tiktok-feed/./bblocksdk/utils/scramble.js","webpack://b-tiktok-feed/./bblocksdk/assets/js/license.js","webpack://b-tiktok-feed/./src/license.js"],"sourcesContent":["const scramble = (data = \"\", type = \"encode\") => {\n  const originalKey = \"abcdefghijklmnopqrstuvwxyz1234567890 -\";\n  const key = \"z1ntg4ihmwj5cr09byx8spl7ak6vo2q3eduf!$\";\n  let resultData = \"\";\n  if (type == \"encode\") {\n    if (data != \"\") {\n      const length = data.length;\n      for (let i = 0; i < length; i++) {\n        const position = originalKey.indexOf(data[i]);\n        if (position !== -1) {\n          resultData += key[position];\n        } else {\n          resultData += data[i];\n        }\n      }\n    }\n  }\n\n  if (type == \"decode\") {\n    if (data != \"\") {\n      const length = data.length;\n      for (let i = 0; i < length; i++) {\n        const currentChar = data[i];\n        const position = key.indexOf(currentChar);\n        if (position !== -1) {\n          resultData += originalKey[position];\n        } else {\n          resultData += currentChar;\n        }\n      }\n    }\n  }\n  return resultData;\n};\n\nexport default scramble;\n","import scramble from \"../../utils/scramble\";\nimport \"./../css/license.scss\";\n\nclass LicenseHandler {\n  constructor(prefix, products = []) {\n    this.prefix = prefix;\n    this.products = products;\n    this.info = window[`${this.prefix}License`] || window[`${this.prefix}Layer`];\n  }\n\n  initialize() {\n    const modal = document.querySelector(`.${this.prefix}_license_popup .popupWrapper`);\n    if (!modal) {\n      console.error(\"modal undefined\");\n      return;\n    }\n\n    this.endpoint = \"https://bplugins.com\" + \"/wp-json/license/v1/gumroad\";\n    this.modal = modal;\n\n    this.agreed = false;\n\n    // elements\n    const opener = document.querySelector(`.${this.prefix}_modal_opener`);\n    const closer = modal.querySelector(\".closer\");\n    const agree = modal.querySelector(\".agree\");\n    const activateBtn = modal.querySelector(\".btn-activate\");\n    const deactivateBtn = modal.querySelector(\".btn-deactivate\");\n    const loader = modal.querySelector(\".bpl_loader\");\n    this.headers = { \"content-Type\": \"application/json\" };\n\n    if (!opener) console.error(\"opener not found\");\n    if (!closer) console.error(\"closer not found\");\n    if (!loader) console.error(\"loader not found\");\n\n    opener?.addEventListener(\"click\", (e) => {\n      e.preventDefault();\n      modal.style.display = \"block\";\n    });\n\n    closer?.addEventListener(\"click\", (e) => {\n      e.preventDefault();\n      modal.style.display = \"none\";\n    });\n\n    agree?.addEventListener(\"click\", () => {\n      this.agreed = agree?.checked;\n      if (activateBtn) activateBtn.disabled = !agree?.checked;\n    });\n\n    activateBtn?.addEventListener(\"click\", async (e) => {\n      e.preventDefault();\n      loader.style.display = \"inline-block\";\n      activateBtn.disabled = true;\n      const field = modal.querySelector(\"input.license_key\");\n      if (field?.value) {\n        const licenseKey = field?.value?.includes(\"$\") ? scramble(field.value, \"decode\") : field?.value;\n        const activate = await this.activeLicense(licenseKey, this.products);\n        if (activate) {\n          this.setNotice(\"notice-success\", \"License key Activated!, Thank you\");\n        }\n        //  else {\n        //   this.setNotice(\"notice-warning\", \"Something went wrong!\");\n        // }\n      } else {\n        this.setNotice(\"notice-warning\", \"Please input a license key\");\n      }\n\n      activateBtn.disabled = false;\n      loader.style.display = \"none\";\n    });\n\n    deactivateBtn?.addEventListener(\"click\", async (e) => {\n      e.preventDefault();\n      loader.style.display = \"inline-block\";\n      deactivateBtn.disabled = true;\n\n      const field = modal.querySelector(\"input.license_key\");\n\n      if (field?.value) {\n        const licenseKey = scramble(field.value, \"decode\");\n        const deactivate = await this.deactiveLicense(licenseKey, this.products);\n        if (deactivate) {\n          this.setNotice(\"notice-success\", \"License key deactivated.\");\n        }\n      }\n\n      deactivateBtn.disabled = false;\n      loader.style.display = \"none\";\n    });\n  }\n\n  async serverHandler(params) {\n    const data = {\n      quantity: 1,\n      website: window.location?.origin,\n      product: this.prefix,\n      email: this.info?.email,\n      action: \"add\",\n      ...params,\n    };\n\n    const response = await fetch(this.endpoint, {\n      method: \"POST\",\n      headers: {\n        \"content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(data),\n    })\n      .then((res) => res.json())\n      .then((res) => res);\n\n    return response;\n  }\n\n  async activeLicense(license_key) {\n    const { permalink, success, quantity, isAppSumo } = await this.verifyGumroad(license_key);\n    if (success) {\n      const { active, message } = await this.serverHandler({ license_key, quantity, isAppSumo });\n      if (active) {\n        const data = new FormData();\n        data.append(\"action\", `${this.prefix}_active_license_key`);\n        data.append(\"data\", scramble(JSON.stringify({ activated: true, key: license_key, permalink, time: new Date().getTime() + \"\" })));\n        data.append(\"nonce\", this.info?.nonce);\n        const activatePlugin = await fetch(this.info?.ajaxURL, {\n          method: \"POST\",\n          body: data,\n        })\n          .then((res) => res.json())\n          .then((res) => res);\n        return activatePlugin?.success;\n      } else {\n        this.setNotice(\"notice-warning\", message);\n      }\n    } else {\n      this.setNotice(\"notice-warning\", \"Invalid License key\");\n    }\n  }\n\n  async verifyLicense(license_key) {\n    const { permalink, success } = await this.verifyGumroad(license_key);\n\n    const data = new FormData();\n    data.append(\"action\", `${this.prefix}_active_license_key`);\n    data.append(\"data\", scramble(JSON.stringify({ activated: success, key: license_key, permalink, time: new Date().getTime() + \"\" })));\n    data.append(\"nonce\", this.info?.nonce);\n\n    try {\n      await fetch(this.info?.ajaxURL, {\n        method: \"POST\",\n        body: data,\n      })\n        .then((res) => res.json())\n        .then((res) => res);\n    } catch (error) {\n      console.log(error.message);\n    }\n  }\n\n  async deactiveLicense(license_key) {\n    const { permalink, success, quantity, isAppSumo } = await this.verifyGumroad(license_key);\n\n    if (success) {\n      const deactivated = await this.serverHandler({ license_key, action: \"deactive\" });\n      if (deactivated) {\n        const data = new FormData();\n        data.append(\"action\", `${this.prefix}_active_license_key`);\n        data.append(\"data\", this.agreed ? \"{}\" : scramble(JSON.stringify({ activated: false, key: license_key, permalink })));\n        data.append(\"nonce\", this.info?.nonce);\n\n        const deactivate = await fetch(this.info?.ajaxURL, {\n          method: \"POST\",\n          body: data,\n        })\n          .then((res) => res.json())\n          .then((res) => res);\n        return deactivate?.success;\n      } else {\n        this.setNotice(\"notice-warning\", \"something went wrong!\");\n      }\n    } else {\n      this.setNotice(\"notice-warning\", \"invalid license key!\");\n    }\n  }\n\n  async verifyGumroad(key) {\n    let response = {};\n    for (let product of this.products) {\n      let res = await fetch(\"https://api.gumroad.com/v2/licenses/verify\", {\n        method: \"POST\",\n        headers: { \"content-Type\": \"application/json\" },\n        body: JSON.stringify({ product_permalink: product, license_key: key }),\n      })\n        .then((res) => res.json())\n        .then((res) => res);\n      if (res.success) {\n        response = res;\n        break;\n      }\n    }\n    const quantity = this.getQuantity(response);\n    const isAppSumo = response?.purchase?.product_name?.includes(\"Sumo\") || false;\n    const permalink = response?.purchase?.permalink;\n    return { quantity, success: response.success, permalink, isAppSumo };\n  }\n\n  setNotice(classes, noticeText) {\n    const noticeParent = this.modal.querySelector(\".license_notice\");\n    const notice = document.createElement(\"div\");\n    notice.classList = `notice ${classes}`;\n    notice.innerText = noticeText;\n    noticeParent.appendChild(notice);\n    setTimeout(() => {\n      notice.remove();\n      if (classes == \"notice-success\") {\n        location.reload();\n      }\n    }, 2000);\n    return;\n  }\n\n  getQuantity(response) {\n    const variants = {\n      \"(Single Site)\": 1,\n      \"Single Site \": 1,\n      \"(3 Sites)\": 3,\n      \"3 Sites\": 3,\n      \"(5 Sites)\": 5,\n      \"(Developer  - Unlimited)\": 1000,\n      \"Developer / Unlimited sites\": 1000,\n      \"(Developer)\": 1000,\n    };\n    let quantity = variants[response?.purchase?.variants] || 1;\n\n    return quantity;\n  }\n}\n\nexport default LicenseHandler;\n","\r\nimport LicenseHandler from \"./../bblocksdk/assets/js/license\";\r\ndocument.addEventListener(\"DOMContentLoaded\", function () {\r\n    const license = new LicenseHandler(\"ttp\", [\"tiktok\"]);\r\n    license.initialize();\r\n});"],"names":["data","type","originalKey","key","resultData","length","i","position","indexOf","currentChar","LicenseHandler","prefix","products","this","info","window","modal","document","querySelector","endpoint","agreed","opener","closer","agree","activateBtn","deactivateBtn","loader","headers","console","error","addEventListener","e","preventDefault","style","display","checked","disabled","field","value","licenseKey","includes","scramble","activeLicense","setNotice","deactiveLicense","params","quantity","website","location","origin","product","email","action","fetch","method","body","JSON","stringify","then","res","json","response","license_key","verifyGumroad","permalink","success","isAppSumo","serverHandler","active","message","FormData","append","activated","time","Date","getTime","nonce","ajaxURL","activatePlugin","log","deactivate","product_permalink","getQuantity","purchase","product_name","classes","noticeText","noticeParent","notice","createElement","classList","innerText","appendChild","setTimeout","remove","reload","variants","initialize"],"sourceRoot":""}